<center><h1>C语言中的表达式和语句是如何协调程序运行的</center></h1></center>

前面我们说了C语言中的运算符，它提供了数据运算的原子操作。但是当存在多个运算符时，C语言是如何保证数据的正确处理的呢？

## 一、表达式

表达式expression，是操作符（运算符）operator和操作数operand的结合。例如：

```c
(1 + 2) * 3 + 4 / 5
```

当表达式中有多个运算符和操作数时，C语言会通过运算符的优先级和结合性来确保表达式运算的正确性。以上面为例：`*`和`/`的优先级比`+`要高，因此，我们要先计算`(1 + 2) * 3`和`4 / 5`的值，然后再计算两个结果的和，最终得出最后的值。但是`*`和`/`中哪个先进性运算呢？这就要看`*`和`/`的结合性了，它们都是左结合的，在上面的例子中，`*`在`/`的左面，因此根据左结合性，我们要先算`*`，再算`/`。

对于这种表达式，在编译时，它的计算顺序会显现在AST(Abstract Syntax Tree)上，这是编译原理的内容，在后期，Meng语言和编译器的项目会用到编译原理。我会将编译原理的学习内容放在编译原理的项目中。



## 二、语句

语句statement，是构成程序的最大粒度的单位。

语句可以分为5种：

1. 复合语句
2. 表达式语句
3. 选择语句
4. 迭代语句
5. 跳转语句



复合语句是指以`{}`包裹起来的语句。

表达式语句有赋值语句：

```c
a = 2;
b -= 3;
c = a * b;
```

选择语句有`if_else`、`switch case`。

`if_else`的底层实现如下：

![](https://raw.githubusercontent.com/zrmin/C-Programming-Language/master/images/202112142154781.png)

可以看出，`if_else`的底层实现采用的是`cmp`来判断if的条件判断是否成立，然后`jne`来进行跳转。

* 下面我们来看一看`switch case`的底层实现：

![image-20211214220825490](https://raw.githubusercontent.com/zrmin/C-Programming-Language/master/images/202112142208585.png)

可以看出`switch_case`也是通过比较a的值，然后跳转到对应的地址，执行相应的运算的。

迭代语句有`for`、`while`、`do_while`。

我们以`do_while`为例，其实迭代语句的底层实现大同小异：

![image-20211214221359040](https://raw.githubusercontent.com/zrmin/C-Programming-Language/master/images/202112142213141.png)

从上图的汇编中，我们可以看出，先打印a的值，然后将a的值减一后送回栈中存储a的值的地址处，然后比较a的旧值是否为0，因为我们的while中的条件是`a--`，所以比较的是a原本的值，而不是`a--`后的值。

从上图的汇编代码中，我们也可以看出`a--`操作的本质：

1. 将a的值送到栈中的一个地址处
2. 将栈中存储a的值的那个地址出的值（a的值）赋值给一个寄存器eax
3. 将eax的值减1后送给寄存器ecx
4. 将ecx的值送到栈中存储a的值的地址处去
5. 下面的操作使用的是eax寄存器中的值，即a的旧值（将eax的值与0作比较，决定是否结束迭代），而非a--之后的新值，即ecx中的值

下面我们将`a--`替换成`--a`来观察一下`a--`和`--a`到底那个更快：

![image-20211214222105732](https://raw.githubusercontent.com/zrmin/C-Programming-Language/master/images/202112142221835.png)

可以看出当我们使用`--a`而非`a--`的时候，汇编代码中是这样操作的：

1. 将a的值送到栈中的某个地址处
2. 将栈中存储a的值的那个地址处的值，即将a的值送往寄存器eax
3. 将eax减1后送往原栈中保存a值的地址
4. 后续的操作使用的是eax中的值（将eax的值与0作比较，决定是否结束迭代）

我们可以明显地看出来，`--a`比`a--`在运算的时候，节约了一个寄存器`ecx`，也就是说，C语言在做`a--`的时候需要一个额外的空间来存储a的旧值，以做操作，因为操作的是a的旧值。而`--a`则不需要申请额外的空间来存储a的值。

综上，`--a`比`a--`执行效率更高。

其他的迭代语句，如for和while的底层实现都是大同小异的。只要理解了`do while`，也自然可以`举一隅以三隅反`。

跳转语句有`break`、`continue`、`return`、`goto`。

我们看一下`goto`的底层实现：

![image-20211214223620035](https://raw.githubusercontent.com/zrmin/C-Programming-Language/master/images/202112142236125.png)

从上图的汇编代码中，我们可以看出，goto语句也是cmp条件比较，如果跳转不满足就`jne`跳转到指定的地方去执行特定的操作。其他的跳转语句的实现方式和`goto`大同小异。

